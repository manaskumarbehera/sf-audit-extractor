<!-- html
File: `popup.html` (replace body content with this)
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Salesforce Audit Trail Extractor</title>
    <link rel="stylesheet" href="popup.css" />
</head>
<body>
<div class="container">
    <header class="tabs-header">
        <div class="tabs-left">
            <nav class="tabs" role="tablist" aria-label="Views">
                <button class="tab-button active" role="tab" aria-selected="true" data-tab="sf">Audit Trails</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="platform">Platform Events</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="lms">Lightning Message Service</button>
                <!-- New tabs -->
                <button class="tab-button" role="tab" aria-selected="false" data-tab="soql">SOQL Builder</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="graphql">GraphQL</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="record">Current Record</button>
            </nav>
        </div>

        <div class="tabs-right">
            <h1 id="header-title">Audit Trails</h1>
            <div class="status" id="status">
                <span class="status-dot"></span>
                <span class="status-text">Not connected</span>
            </div>
            <button id="pe-pin" class="header-icon-btn" aria-label="Pin Platform Events window" title="Pin Platform Events window"></button>
        </div>
    </header>

    <section class="tab-contents">
        <div id="tab-sf" class="tab-pane" data-tab="sf" style="display: block;">
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls">
                        <button id="fetch-btn" class="icon-btn" aria-label="Fetch Audit Logs" title="Fetch Audit Logs">
                            <span aria-hidden="true">‚Üª</span>
                        </button>
                        <button id="export-btn" class="icon-btn" aria-label="Export CSV" title="Export CSV" disabled>
                            <span aria-hidden="true">‚Üì</span>
                        </button>
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>

            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search audit logs..." aria-label="Search audit logs" disabled />
            </div>

            <div class="filters">
                <label class="filter-label" for="category-filter">Category:</label>
                <select id="category-filter" disabled>
                    <option value="all">All Categories</option>
                    <option value="User Management">User Management</option>
                    <option value="Security">Security</option>
                    <option value="Object Changes">Object Changes</option>
                </select>
            </div>

            <div class="stats" id="stats" style="display: none;">
                <div class="stat-item">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value" id="total-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">User Mgmt:</span>
                    <span class="stat-value" id="user-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Security:</span>
                    <span class="stat-value" id="security-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Objects:</span>
                    <span class="stat-value" id="object-count">0</span>
                </div>
            </div>

            <div class="logs-container" id="logs-container">
                <div class="placeholder">
                    <p>Audit logs are not loaded yet</p>
                    <p class="placeholder-note">Use the refresh icon to fetch audit logs</p>
                </div>
            </div>
        </div>

        <div id="tab-platform" class="tab-pane" data-tab="platform" style="display: none;">
            <div class="platform-header">
                <div class="platform-left">
                    <div class="platform-controls">
                        <button id="pe-refresh" class="icon-btn" aria-label="Fetch Platform Events" title="Fetch Platform Events">
                            <span aria-hidden="true">‚Üª</span>
                        </button>
                    </div>
                </div>
                <div class="platform-right">
                    <div class="status" id="cometd-status" title="Disconnected">
                        <span class="status-dot"></span>
                        <span class="status-text">Disconnected</span>
                    </div>
                </div>
            </div>

            <div class="platform-content">
                <div class="platform-events">
                    <h2 class="section-title">Platform Events</h2>
                    <div id="platform-events-list" class="list">
                        <div class="placeholder">
                            <p>No events loaded</p>
                            <p class="placeholder-note">Click the refresh icon to load Platform Events</p>
                        </div>
                    </div>
                </div>
                <div class="platform-log">
                    <h2 class="section-title">Event Messages</h2>
                    <div class="log-toolbar">
                        <div class="toolbar-left">
                            <button id="pe-log-clear" class="icon-btn btn-sm" aria-label="Clear log" title="Clear log"><span aria-hidden="true">üóë</span></button>
                            <button id="pe-log-pause" class="icon-btn btn-sm" aria-pressed="false" aria-label="Pause logging" title="Pause logging"><span aria-hidden="true">‚è∏</span></button>
                        </div>
                        <div class="toolbar-right">
                            <button id="pe-log-autoscroll-btn" class="icon-btn btn-sm" aria-pressed="true" aria-label="Toggle auto-scroll" title="Auto-scroll: on"><span aria-hidden="true">‚§ì</span></button>
                            <select id="pe-log-filter" class="log-filter compact" aria-label="Filter">
                                <option value="all" selected>All</option>
                                <option value="event">Events</option>
                                <option value="system">System</option>
                                <option value="subscribe">Subscribe</option>
                                <option value="error">Errors</option>
                            </select>
                        </div>
                    </div>
                    <div id="platform-event-log" class="logs-container">
                        <div class="placeholder-note">No messages yet</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-lms" class="tab-pane" data-tab="lms" style="display: none;">
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls">
                        <button id="lms-refresh" class="icon-btn" aria-label="Fetch LMS Channels" title="Fetch LMS Channels">
                            <span aria-hidden="true">‚Üª</span>
                        </button>
                        <!-- No publish button: sample payload only -->
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>

            <div class="filters" style="gap: 8px;">
                <label class="filter-label" for="lms-channel">Channel:</label>
                <select id="lms-channel" disabled>
                    <option value="">Select a message channel</option>
                </select>
            </div>

            <!-- Sample payload view (no publish) -->
            <div class="search-box">
                <div class="sample-payload-wrap">
                    <textarea id="lms-payload" rows="6" placeholder='Sample payload will appear here after selecting a channel' aria-label="Sample LMS payload"></textarea>
                    <button id="lms-payload-copy" class="icon-btn copy-overlay-btn" aria-label="Copy sample payload" title="Copy sample payload">üìã</button>
                </div>
            </div>

            <div id="lms-log" class="logs-container">
                <div class="placeholder-note">No LMS activity yet</div>
            </div>
        </div>

        <!-- SOQL Builder tab -->
        <div id="tab-soql" class="tab-pane" data-tab="soql" style="display: none;">
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls" style="gap: 8px; align-items: center;">
                        <button id="soql-run" class="icon-btn" aria-label="Run SOQL (Ctrl/Cmd+Enter)" title="Run SOQL (Ctrl/Cmd+Enter)"><span aria-hidden="true">‚ñ∂</span></button>
                        <label for="soql-limit" class="filter-label">Limit:</label>
                        <input id="soql-limit" type="number" min="1" step="1" value="200" style="width: 84px;" aria-label="Limit" />
                        <label class="toggle">
                            <input id="soql-tooling" type="checkbox" /> Tooling
                        </label>
                        <button id="soql-export" class="icon-btn" aria-label="Export results to CSV" title="Export results to CSV" disabled><span aria-hidden="true">‚Üì</span></button>
                        <button id="soql-export-json" class="icon-btn" aria-label="Export results to JSON" title="Export results to JSON" disabled>{}</button>
                        <button id="soql-export-xls" class="icon-btn" aria-label="Export results to Excel" title="Export results to Excel" disabled>‚åÅ</button>
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>

            <div class="soql-split">
                <!-- Schema sidebar -->
                <aside class="soql-left" aria-label="SOQL Schema">
                    <div class="schema-toolbar">
                        <input id="schema-search" type="text" placeholder="Search fields" aria-label="Search fields" />
                        <select id="schema-type-filter" aria-label="Filter by field type">
                            <option value="">All types</option>
                        </select>
                        <select id="soql-recent-objects" aria-label="Recent objects">
                            <option value="">Recent objects</option>
                        </select>
                    </div>
                    <div class="schema-meta">
                        <div id="schema-object">Object: ‚Äî</div>
                        <div><span id="schema-field-count">0</span> fields</div>
                    </div>
                    <div id="schema-fields" class="schema-list" aria-label="Fields list"></div>
                    <div id="schema-children-list" class="schema-children" aria-label="Child relationships"></div>
                </aside>

                <!-- Resizer between schema and editor -->
                <div id="soql-resizer" class="soql-resizer" role="separator" aria-label="Resize schema panel" aria-orientation="vertical" tabindex="0"></div>

                <!-- Editor/results panel -->
                <section class="soql-right">
                    <div class="search-box editor-box">
                        <div class="editor-wrap">
                            <pre id="soql-highlight" class="editor-highlight" aria-hidden="true"></pre>
                            <textarea id="soql-input" rows="6" placeholder="SELECT Id, Name FROM Account LIMIT 200" aria-label="SOQL query"></textarea>
                        </div>
                        <div id="soql-suggestions" class="suggestions" aria-label="SOQL suggestions" role="listbox"></div>
                    </div>
                    <div id="soql-results" class="logs-container">
                        <div class="placeholder-note">Enter a SOQL query and click Run</div>
                    </div>
                    <div id="soql-metrics" class="metrics" aria-live="polite"></div>
                </section>
            </div>
        </div>

        <!-- GraphQL Query Builder tab -->
        <div id="tab-graphql" class="tab-pane" data-tab="graphql" style="display: none;">
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls">
                        <button id="gql-run" class="icon-btn" aria-label="Run GraphQL" title="Run GraphQL"><span aria-hidden="true">‚ñ∂</span></button>
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>
            <div class="search-box" style="display: grid; gap: 8px;">
                <textarea id="gql-query" rows="6" placeholder="query { uiapi { query { Account { edges { node { Id Name { value } } } } }" aria-label="GraphQL query"></textarea>
                <textarea id="gql-variables" rows="3" placeholder='{"limit": 10}' aria-label="GraphQL variables (optional)"></textarea>
            </div>
            <div id="gql-results" class="logs-container">
                <div class="placeholder-note">Enter a GraphQL query and click Run</div>
            </div>
        </div>

        <!-- Current Record Utility tab -->
        <div id="tab-record" class="tab-pane" data-tab="record" style="display: none;">
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls">
                        <button id="record-detect" class="icon-btn" aria-label="Detect record Id from URL" title="Detect from URL"><span aria-hidden="true">üîç</span></button>
                        <button id="record-fetch" class="icon-btn" aria-label="Fetch record" title="Fetch record"><span aria-hidden="true">‚ñ∂</span></button>
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>
            <div class="filters" style="gap: 8px; align-items: center;">
                <label class="filter-label" for="record-id">Record Id:</label>
                <input id="record-id" type="text" placeholder="e.g. 001XXXXXXXXXXXX or 003..." aria-label="Salesforce record Id" />
            </div>
            <div id="record-results" class="logs-container">
                <div class="placeholder-note">Enter a record Id or click the detect icon</div>
            </div>
        </div>

    </section>
</div>

<script src="popup.js"></script>
</body>
</html>
