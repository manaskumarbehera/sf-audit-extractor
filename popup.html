<!-- html
File: `popup.html` (replace body content with this)
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Salesforce Audit Trail Extractor</title>
    <link rel="stylesheet" href="popup.css" />
</head>
<body>
<div class="container">
    <header class="tabs-header">
        <div class="tabs-left">
            <nav class="tabs" role="tablist" aria-label="Views">
                <button class="tab-button active" role="tab" aria-selected="true" data-tab="sf">Audit Trails</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="platform">Platform Events</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="lms">Lightning Message Service</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="soql">SOQL Query Builder</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="graphql">GraphQL Query Builder</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="data">Data Explorer</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="settings">Settings</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="help">Help</button>
                <button class="tab-button" role="tab" aria-selected="false" data-tab="about">About</button>
            </nav>
        </div>

        <div class="tabs-right">
            <h1 id="header-title">Audit Trails</h1>
            <div class="status" id="status">
                <span class="status-dot"></span>
                <span class="status-text">Not connected</span>
            </div>
            <label for="api-version" class="api-version-label" title="Salesforce API version">API</label>
            <select id="api-version" class="api-version-select" aria-label="Salesforce API version">
                <option value="66.0">66.0</option>
                <option value="65.0">65.0</option>
                <option value="64.0">64.0</option>
                <option value="63.0">63.0</option>
                <option value="62.0">62.0</option>
                <option value="61.0">61.0</option>
                <option value="60.0">60.0</option>
            </select>
            <button id="app-pop" class="header-icon-btn" aria-label="Pop out window" title="Pop out window"></button>
        </div>
    </header>

    <section class="tab-contents">
        <div id="tab-sf" class="tab-pane" data-tab="sf" style="display: block;">
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls">
                        <button id="fetch-btn" class="icon-btn" aria-label="Fetch Audit Logs" title="Fetch Audit Logs">
                            <span aria-hidden="true">‚ü≤</span>
                        </button>
                        <button id="export-btn" class="icon-btn" aria-label="Export CSV" title="Export CSV" disabled>
                            <span aria-hidden="true">‚Üì</span>
                        </button>
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>

            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search audit logs..." aria-label="Search audit logs" disabled />
            </div>

            <div class="filters">
                <label class="filter-label" for="category-filter">Category:</label>
                <select id="category-filter" disabled>
                    <option value="all">All Categories</option>
                    <option value="User Management">User Management</option>
                    <option value="Security">Security</option>
                    <option value="Object Changes">Object Changes</option>
                </select>
            </div>

            <div class="stats" id="stats" style="display: none;">
                <div class="stat-item">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value" id="total-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">User Mgmt:</span>
                    <span class="stat-value" id="user-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Security:</span>
                    <span class="stat-value" id="security-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Objects:</span>
                    <span class="stat-value" id="object-count">0</span>
                </div>
            </div>

            <div class="logs-container" id="logs-container">
                <div class="placeholder">
                    <p>Audit logs are not loaded yet</p>
                    <p class="placeholder-note">Use the refresh icon to fetch audit logs</p>
                </div>
            </div>
        </div>

        <div id="tab-platform" class="tab-pane" data-tab="platform" hidden>
            <div class="platform-header">
                <div class="platform-left">
                    <div class="platform-controls">
                        <button id="pe-refresh" class="icon-btn" aria-label="Fetch Platform Events" title="Fetch Platform Events">
                            <span aria-hidden="true">‚ü≤</span>
                        </button>
                    </div>
                </div>
                <div class="platform-right">
                    <div class="status" id="cometd-status" title="Disconnected">
                        <span class="status-dot"></span>
                        <span class="status-text">Disconnected</span>
                    </div>
                </div>
            </div>

            <div class="platform-content">
                <div class="platform-events">
                    <h2 class="section-title">Platform Events</h2>
                    <div id="platform-events-list" class="list">
                        <div class="placeholder">
                            <p>No events loaded</p>
                            <p class="placeholder-note">Click the refresh icon to load Platform Events</p>
                        </div>
                    </div>
                </div>
                <div class="platform-log">
                    <h2 class="section-title">Event Messages</h2>
                    <div class="log-toolbar">
                        <div class="toolbar-left">
                            <button id="pe-log-clear" class="icon-btn btn-sm" aria-label="Clear log" title="Clear log"><span aria-hidden="true">üóë</span></button>
                            <button id="pe-log-pause" class="icon-btn btn-sm" aria-pressed="false" aria-label="Pause logging" title="Pause logging"><span aria-hidden="true">‚è∏</span></button>
                        </div>
                        <div class="toolbar-right">
                            <button id="pe-log-autoscroll-btn" class="icon-btn btn-sm" aria-pressed="true" aria-label="Toggle auto-scroll" title="Auto-scroll: on"><span aria-hidden="true">‚§ì</span></button>
                            <select id="pe-log-filter" class="log-filter compact" aria-label="Filter">
                                <option value="all" selected>All</option>
                                <option value="event">Events</option>
                                <option value="system">System</option>
                                <option value="subscribe">Subscribe</option>
                                <option value="unsubscribe">Unsubscribe</option>
                                <option value="error">Errors</option>
                            </select>
                        </div>
                    </div>
                    <div id="platform-event-log" class="logs-container">
                        <div class="placeholder-note">No messages yet</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-lms" class="tab-pane" data-tab="lms" hidden>
            <div class="audit-header">
                <div class="audit-left">
                    <div class="audit-controls">
                        <button id="lms-refresh" class="icon-btn" aria-label="Fetch LMS Channels" title="Fetch LMS Channels">
                            <span aria-hidden="true">‚ü≤</span>
                        </button>
                        <!-- No publish button: sample payload only -->
                    </div>
                </div>
                <div class="audit-right"></div>
            </div>

            <div class="filters" style="gap: 8px;">
                <label class="filter-label" for="lms-channel">Channel:</label>
                <select id="lms-channel" disabled>
                    <option value="">Select a message channel</option>
                </select>
            </div>

            <!-- Sample payload view (no publish) -->
            <div class="search-box">
                <div class="sample-payload-wrap">
                    <textarea id="lms-payload" rows="6" placeholder='Sample payload will appear here after selecting a channel' aria-label="Sample LMS payload"></textarea>
                    <button id="lms-payload-copy" class="icon-btn copy-overlay-btn" aria-label="Copy sample payload" title="Copy sample payload">üìã</button>
                </div>
            </div>

            <div id="lms-log" class="logs-container">
                <div class="placeholder-note">No LMS activity yet</div>
            </div>
        </div>

        <div id="tab-soql" class="tab-pane" data-tab="soql" hidden>
            <div class="filters" style="gap: 8px; align-items: center;">
                <label class="filter-label" for="soql-tooling">Tooling API:</label>
                <input type="checkbox" id="soql-tooling" aria-label="Use Tooling API">


                <div id="soql-object-group" style="display: inline-flex; align-items: center; gap: 8px;">
                    <label class="filter-label" for="soql-object">SObject:</label>
                    <select id="soql-object" aria-label="Select SObject" autocomplete="off">
                        <option value="">Select an object</option>
                    </select>
                </div>

                <!-- New: limit control -->
                <label class="filter-label" for="soql-limit" title="Max records to fetch">Limit:</label>
                <input id="soql-limit" type="number" min="1" max="5000" value="200" style="width: 90px; padding: 6px 8px;" aria-label="Max records to fetch" />


                <button id="soql-run" class="icon-btn btn-sm" title="Run Query" aria-label="Run Query">
                    <span aria-hidden="true">‚ñ∂</span>
                </button>
                <button id="soql-clear" class="icon-btn btn-sm" title="Clear results" aria-label="Clear results">
                    <span aria-hidden="true">üóë</span>
                </button>
            </div>

            <!-- SOQL query tabs bar -->
            <div id="soql-tabs" class="soql-tabbar" role="tablist" aria-label="SOQL query tabs">
                <div class="soql-tablist"></div>
                <button id="soql-tab-add" class="icon-btn btn-sm" title="New query tab" aria-label="New query tab">Ôºã</button>
            </div>

            <!-- Query Editor (Top) -->
            <div class="search-box" style="margin-bottom: 0; border-bottom: 1px solid var(--border-color);">
                <textarea id="soql-query" rows="4" placeholder="SELECT Id, Name FROM Account LIMIT 10" aria-label="SOQL query" style="resize: vertical; min-height: 80px; font-family: monospace;"></textarea>
                <div id="soql-guidance" class="soql-guidance" aria-live="polite">
                    <div class="soql-guidance-card">
                        <div class="soql-guidance-card-title">Write a focused SOQL query</div>
                        <div class="soql-guidance-card-message">Start by selecting a small field list and limit the records you pull back.</div>
                    </div>
                    <div class="soql-guidance-flags" role="list"></div>
                </div>
            </div>

            <!-- Split View Container -->
            <div class="soql-split-container" style="display: flex; flex: 1; overflow: hidden; min-height: 0;">

                <!-- Left Pane: Builder Controls -->
                <div class="soql-split-left" style="width: 320px; min-width: 250px; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; background: var(--bg-subtle);">

                    <!-- Guided query builder toggle -->
                    <div class="soql-builder-toggle" style="padding: 8px; border-bottom: 1px solid var(--border-color);">
                        <label class="builder-toggle-label">
                            <input type="checkbox" id="soql-builder-enabled" aria-label="Enable guided query builder" />
                            <span>Guided builder</span>
                        </label>
                    </div>

                    <div id="soql-builder" class="soql-builder" hidden style="margin-top: 0; padding: 8px; overflow-y: auto; flex: 1;">
                        <div class="builder-section" aria-label="Select fields" style="margin-bottom: 12px;">
                            <div class="builder-section-header">
                                <span class="builder-title">Fields</span>
                                <button id="soql-builder-add-field" class="btn-chip" type="button" title="Add field">+ Add</button>
                            </div>
                            <div class="builder-field-add">
                                <input id="soql-builder-field-input" list="soql-builder-field-list" placeholder="Start typing a field" aria-label="Field to add" />
                                <datalist id="soql-builder-field-list"></datalist>
                            </div>
                            <div id="soql-builder-fields" class="chip-wrap builder-chip-wrap" aria-live="polite"></div>
                        </div>

                        <div class="builder-section" aria-label="Add filters" style="margin-bottom: 12px;">
                            <div class="builder-section-header">
                                <span class="builder-title">Filters</span>
                                <button id="soql-builder-add-filter" class="btn-chip" type="button" title="Add filter">+ Filter</button>
                            </div>
                            <div id="soql-builder-filters" class="builder-filters" aria-live="polite"></div>
                        </div>

                        <div class="builder-section" aria-label="Order by" style="margin-bottom: 12px;">
                            <div class="builder-section-header">
                                <span class="builder-title">Order by</span>
                                <button id="soql-builder-clear-order" class="icon-btn btn-sm" type="button" title="Clear ordering">‚úï</button>
                            </div>
                            <div class="builder-inline">
                                <input id="soql-builder-order-field" list="soql-builder-field-list" placeholder="Field" aria-label="Order by field" />
                                <select id="soql-builder-order-dir" aria-label="Order direction">
                                    <option value="asc">ASC</option>
                                    <option value="desc">DESC</option>
                                </select>
                            </div>
                        </div>

                        <div class="builder-section builder-note-section" aria-label="Builder status">
                            <div class="builder-title">Status</div>
                            <div id="soql-builder-status" class="builder-status" aria-live="polite">Ready</div>
                        </div>
                    </div>
                </div>

                <!-- Right Pane: Results -->
                <div class="soql-split-right" style="flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0;">
                    <!-- Unified action bar -->
                    <div class="soql-actionbar" style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:flex-start; padding:8px 12px; border-bottom: 1px solid var(--border-color); background: var(--bg-default);">
                        <label class="filter-label" for="soql-view-advanced" title="Toggle Advanced Results" style="margin-right:4px;">Advanced:</label>
                        <input type="checkbox" id="soql-view-advanced" role="switch" aria-label="Advanced results view (on/off)" style="margin-right:16px;" />
                        <span id="soql-status" style="margin-right:auto; font-size:12px; color:#555; padding:2px 4px;">Raw view</span>
                        <div id="soql-export-buttons" style="display:none; gap:8px; align-items:center;">
                          <button class="btn-chip" id="soql-exp-json" title="Copy JSON to clipboard"><span class="ico">üìã</span><span class="lbl">JSON</span></button>
                          <button class="btn-chip" id="soql-exp-csv" title="Copy CSV to clipboard"><span class="ico">üìã</span><span class="lbl">CSV</span></button>
                          <button class="btn-chip" id="soql-exp-tsv" title="Copy TSV (Excel) to clipboard"><span class="ico">üìã</span><span class="lbl">Excel</span></button>
                          <button class="btn-chip" id="soql-exp-download" title="Download CSV file"><span class="ico">‚¨áÔ∏è</span><span class="lbl">Download CSV</span></button>
                        </div>
                    </div>

                    <div id="soql-results" class="logs-container" style="flex: 1; overflow: auto; padding: 0;">
                        <!-- Results will appear here -->
                    </div>
                </div>
            </div>
        </div>
        <div id="tab-graphql" class="tab-pane" data-tab="graphql" hidden>
            <!-- Screen 1: Object Selection -->
            <div id="graphql-screen-objects" class="graphql-screen active">
                <div class="graphql-objects-picker">
                    <div class="graphql-picker-header">
                        <h2>Select an Object</h2>
                        <p class="graphql-picker-subtitle">Choose a Salesforce object to query with GraphQL</p>
                    </div>
                    <div class="graphql-picker-search">
                        <input id="graphql-objects-search" type="search" placeholder="üîç Search objects..." aria-label="Search objects" />
                    </div>
                    <div id="graphql-objects-grid" class="graphql-objects-grid" aria-live="polite">
                        <div class="placeholder-note">Loading objects...</div>
                    </div>
                    <div class="graphql-picker-footer">
                        <button id="graphql-refresh-objects" class="btn btn-secondary" type="button">‚ü≥ Refresh Objects</button>
                        <button id="graphql-advanced-mode" class="btn btn-tertiary" type="button">Advanced Mode</button>
                    </div>
                </div>
            </div>

            <!-- Screen 2: Query Builder -->
            <div id="graphql-screen-builder" class="graphql-screen hidden">
                <div class="graphql-builder-header">
                    <div class="graphql-builder-title">
                        <button id="graphql-back-to-objects" class="icon-btn" type="button" title="Back to objects">‚Üê</button>
                        <h2>GraphQL: <span id="graphql-current-object">-</span></h2>
                    </div>
                    <div class="graphql-header-controls">
                        <label class="builder-toggle-label">
                            <input type="checkbox" id="graphql-builder-enabled" aria-label="Enable query builder" />
                            <span>Builder</span>
                        </label>
                        <span id="graphql-schema-status" class="schema-status" aria-live="polite">Ready</span>
                    </div>
                </div>

                <div class="graphql-builder-container">
                    <!-- Left Panel: Composition (Builder) -->
                    <div class="graphql-builder-left" id="graphql-builder-panel">
                        <datalist id="graphql-builder-field-list"></datalist>

                        <!-- Fields Section -->
                        <div class="builder-section">
                            <div class="builder-section-header">
                                <span class="builder-title">Fields</span>
                                <button id="graphql-builder-add-field" class="btn-chip btn-sm" type="button" title="Add field">+ Add</button>
                            </div>
                            <div class="builder-field-add">
                                <input id="graphql-builder-field-input" list="graphql-builder-field-list" placeholder="Field name..." aria-label="Field name" />
                            </div>
                            <div id="graphql-builder-fields" class="builder-field-chips" aria-live="polite"></div>
                        </div>

                        <!-- Filters Section -->
                        <div class="builder-section">
                            <div class="builder-section-header">
                                <span class="builder-title">Filters</span>
                                <button id="graphql-builder-add-filter" class="btn-chip btn-sm" type="button" title="Add filter">+ Filter</button>
                            </div>
                            <div id="graphql-builder-filters" class="builder-filters" aria-live="polite"></div>
                        </div>

                        <!-- Order By Section -->
                        <div class="builder-section">
                            <div class="builder-section-header">
                                <span class="builder-title">Order By</span>
                                <button id="graphql-builder-clear-order" class="icon-btn btn-sm" type="button" title="Clear ordering">‚úï</button>
                            </div>
                            <div class="builder-inline">
                                <input id="graphql-builder-order-field" list="graphql-builder-field-list" placeholder="Field" aria-label="Order by field" />
                                <select id="graphql-builder-order-dir" aria-label="Order direction">
                                    <option value="asc">ASC</option>
                                    <option value="desc">DESC</option>
                                </select>
                            </div>
                        </div>

                        <!-- Pagination Section -->
                        <div class="builder-section">
                            <div class="builder-section-header">
                                <span class="builder-title">Pagination</span>
                            </div>
                            <div class="builder-pagination">
                                <label class="filter-label" for="graphql-limit">Limit:</label>
                                <input id="graphql-limit" type="number" value="50" min="1" aria-label="Result limit" />
                                <label class="filter-label" for="graphql-offset">Offset:</label>
                                <input id="graphql-offset" type="number" value="0" min="0" aria-label="Result offset" />
                                <label class="filter-label" for="graphql-after">After:</label>
                                <input id="graphql-after" type="text" aria-label="After cursor" placeholder="cursor" />
                            </div>
                        </div>

                        <!-- Builder Status -->
                        <div class="builder-section builder-status-section">
                            <div id="graphql-builder-status" class="builder-status" aria-live="polite">Ready</div>
                        </div>
                    </div>

                    <!-- Right Panel: Endpoint Banner + Query/Variables/Results Split -->
                    <div class="graphql-builder-right">
                        <!-- Endpoint Banner (Top) -->
                        <div class="endpoint-banner">
                            <div class="endpoint-banner-item">
                                <span class="endpoint-label">Endpoint:</span>
                                <code id="graphql-endpoint-url">/services/data/vXX.X/graphql</code>
                            </div>
                            <div class="endpoint-banner-item">
                                <span class="endpoint-label">Object:</span>
                                <code id="graphql-endpoint-object">-</code>
                            </div>
                            <div class="endpoint-banner-item">
                                <span class="endpoint-label">Size:</span>
                                <code id="graphql-body-size">0 bytes</code>
                            </div>
                            <div class="endpoint-banner-item">
                                <span class="endpoint-label">Method:</span>
                                <code>POST</code>
                            </div>
                        </div>

                        <!-- Split Container: Query (left) + Variables/Results (right split) -->
                        <div class="graphql-split-container">
                            <!-- Left Side: Query Editor -->
                            <div class="graphql-query-section">
                                <div class="section-header">
                                    <span class="section-title">Query</span>
                                    <div class="section-actions">
                                        <button id="graphql-format-query" class="action-btn" type="button" title="Format (‚åòB)">
                                            <span class="action-icon">{ }</span>
                                            <span class="action-label">Format</span>
                                        </button>
                                        <button id="graphql-copy-query" class="action-btn" type="button" title="Copy">
                                            <span class="action-icon">üìã</span>
                                            <span class="action-label">Copy</span>
                                        </button>
                                    </div>
                                </div>
                                <textarea id="graphql-query" placeholder='query {
  uiapi {
    query {
      Account {
        edges {
          node {
            Id
            Name { value }
          }
        }
      }
    }
  }
}' aria-label="GraphQL query"></textarea>
                            </div>

                            <!-- Vertical Splitter -->
                            <div class="graphql-splitter" id="graphql-splitter" title="Drag to resize"></div>

                            <!-- Right Side: Variables (top) + Results (bottom) -->
                            <div class="graphql-right-panel">
                                <!-- Variables Section -->
                                <div class="graphql-variables-section">
                                    <div class="section-header">
                                        <span class="section-title">Variables</span>
                                        <div class="section-actions">
                                            <button id="graphql-format-vars" class="action-btn" type="button" title="Format JSON (‚åòB)">
                                                <span class="action-icon">{ }</span>
                                                <span class="action-label">Format</span>
                                            </button>
                                            <button id="graphql-copy-vars" class="action-btn" type="button" title="Copy">
                                                <span class="action-icon">üìã</span>
                                                <span class="action-label">Copy</span>
                                            </button>
                                        </div>
                                    </div>
                                    <textarea id="graphql-variables" placeholder='{
  "limit": 10,
  "offset": 0
}' aria-label="GraphQL variables (JSON)"></textarea>
                                </div>

                                <!-- Horizontal Splitter -->
                                <div class="graphql-splitter-h" id="graphql-splitter-h" title="Drag to resize"></div>

                                <!-- Results Section -->
                                <div class="graphql-results-section">
                                    <div class="section-header">
                                        <span class="section-title">Response</span>
                                        <div class="section-actions">
                                            <button id="graphql-copy-results" class="action-btn" type="button" title="Copy Results">
                                                <span class="action-icon">üìã</span>
                                                <span class="action-label">Copy</span>
                                            </button>
                                            <button id="graphql-expand-results" class="action-btn" type="button" title="Toggle Expand">
                                                <span class="action-icon">‚äû</span>
                                                <span class="action-label">Expand</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="graphql-results-container" class="results-container">
                                        <pre id="graphql-results" class="results-pre"><span class="placeholder-note">Run a query to see results</span></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="graphql-builder-actions">
                            <button id="graphql-run" class="btn btn-primary" type="button">‚ñ∂ Run Query</button>
                            <button id="graphql-clear" class="btn btn-secondary" type="button">Clear Results</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Screen 3: Results -->
            <div id="graphql-screen-results" class="graphql-screen hidden">
                <div class="graphql-results-header">
                    <div class="results-title">
                        <button id="graphql-back-to-builder" class="icon-btn" type="button" title="Back to builder">‚Üê</button>
                        <h2>Results: <span id="graphql-results-object">-</span></h2>
                    </div>
                    <div class="results-controls">
                        <button id="graphql-results-clear" class="icon-btn" type="button" title="Clear results">üóë</button>
                    </div>
                </div>

                <div class="graphql-pageinfo" id="graphql-pageinfo" aria-live="polite">
                    <div id="graphql-pageinfo-body">No page info</div>
                    <div class="graphql-pageinfo-actions">
                        <button id="graphql-pageinfo-apply" class="btn-chip btn-sm" type="button" title="Use endCursor as After" disabled>Use endCursor</button>
                        <button id="graphql-pageinfo-clear" class="btn-chip btn-sm" type="button" title="Clear cursor">Clear cursor</button>
                    </div>
                </div>

                <div id="graphql-results-container" class="graphql-results-container">
                    <div class="logs-container" id="graphql-results">
                        <div class="placeholder-note">Run a GraphQL query to see results.</div>
                    </div>
                </div>
            </div>

            <!-- Hidden: Schema search & editor (advanced) -->
            <div id="graphql-schema-results" class="hidden" aria-live="polite"></div>
            <div id="graphql-editor" class="hidden" aria-label="GraphQL editor"></div>
        </div>
        <div id="tab-data" class="tab-pane" data-tab="data" hidden>
            <!-- Sub-tabs navigation -->
            <div class="data-explorer-header">
                <nav class="sub-tabs" role="tablist" aria-label="Data Explorer sections">
                    <button class="sub-tab-button active" role="tab" aria-selected="true" data-subtab="sandbox-manager">Sandbox & Favicon</button>
                    <button class="sub-tab-button" role="tab" aria-selected="false" data-subtab="user-manager">User Manager</button>
                    <button class="sub-tab-button" role="tab" aria-selected="false" data-subtab="current-record">Current Record</button>
                    <button class="sub-tab-button" role="tab" aria-selected="false" data-subtab="record-search">Record Search</button>
                </nav>
            </div>

            <!-- Sub-tab: Sandbox & Favicon Manager -->
            <div id="subtab-sandbox-manager" class="sub-tab-content active" aria-labelledby="sandbox-manager">
                <div class="sandbox-manager-container side-by-side">
                    <div class="section-card">
                        <h3 class="section-card-title">üè¢ Organization Info</h3>
                        <div id="org-info-container" class="details-list">
                            <div class="spinner">Loading organization info...</div>
                        </div>
                    </div>
                    <div class="section-card">
                        <h3 class="section-card-title">üé® Favicon Customization</h3>
                        <p class="section-description">Customize the browser tab favicon to easily identify this Salesforce org/sandbox.</p>
                        <div id="favicon-edit-indicator" style="display:none;margin-bottom:8px;padding:4px 8px;background:#d3f9d8;border-radius:4px;"></div>
                        <div class="favicon-controls">
                            <div class="favicon-preview-row">
                                <label class="filter-label">Preview:</label>
                                <div id="favicon-preview" class="favicon-preview">
                                    <!-- Rendered dynamically by JavaScript -->
                                </div>
                            </div>
                            <div class="favicon-color-row">
                                <label class="filter-label" for="favicon-color">Badge Color:</label>
                                <input type="color" id="favicon-color" value="#ff6b6b" aria-label="Favicon badge color" />
                                <select id="favicon-preset-colors" aria-label="Preset colors">
                                    <option value="">Presets...</option>
                                    <option value="#ff6b6b">üî¥ Red (Production)</option>
                                    <option value="#51cf66">üü¢ Green (Dev)</option>
                                    <option value="#339af0">üîµ Blue (UAT)</option>
                                    <option value="#fcc419">üü° Yellow (QA)</option>
                                    <option value="#9775fa">üü£ Purple (Staging)</option>
                                    <option value="#ff922b">üü† Orange (Hotfix)</option>
                                </select>
                            </div>
                            <div class="favicon-label-row">
                                <label class="filter-label" for="favicon-label">Badge Label:</label>
                                <input type="text" id="favicon-label" maxlength="3" placeholder="DEV" aria-label="Favicon badge label" />
                            </div>
                            <div class="favicon-actions">
                                <button id="favicon-apply" class="btn btn-primary btn-sm">Save & Apply</button>
                                <button id="favicon-reset" class="btn btn-secondary btn-sm">Reset to Default</button>
                            </div>
                            <div id="favicon-status" class="update-status" hidden></div>
                        </div>
                    </div>
                </div>
                <!-- Saved Favicons List -->
                <div class="section-card" style="margin-top: 16px;">
                    <h3 class="section-card-title">üìã Saved Org Favicons</h3>
                    <p class="section-description">Favicons are automatically applied when you visit a saved org.</p>
                    <div id="saved-favicons-list" class="saved-favicons-list">
                        <div class="placeholder-note">No saved favicons yet</div>
                    </div>
                </div>
            </div>

            <!-- Sub-tab: User Manager -->
            <div id="subtab-user-manager" class="sub-tab-content" hidden aria-labelledby="user-manager">
                <div class="user-manager-layout">
                    <!-- Left Panel: Current User + Search -->
                    <div class="user-manager-left">
                        <div class="section-card compact">
                            <div class="section-header-row">
                                <h3 class="section-card-title compact">üë§ Current User</h3>
                                <button id="refresh-user-btn" class="icon-btn btn-sm" aria-label="Refresh" title="Refresh">‚ü≤</button>
                            </div>
                            <div id="user-details-container" class="details-list compact">
                                <div class="spinner">Loading...</div>
                            </div>
                        </div>
                        <div class="section-card compact user-search-section">
                            <h3 class="section-card-title compact">üîç Search & Select User</h3>
                            <div class="user-search-row compact">
                                <input type="text" id="user-search-input" placeholder="Type to search users..." aria-label="Search users" />
                                <button id="user-search-btn" class="btn btn-primary btn-sm">üîç</button>
                            </div>
                            <div id="user-search-results" class="user-search-results compact">
                                <div class="placeholder-note">Search by name, email, or username</div>
                            </div>
                        </div>
                    </div>
                    <!-- Right Panel: Update Settings -->
                    <div class="user-manager-right">
                        <div class="section-card compact user-update-section">
                            <h3 class="section-card-title compact">‚öôÔ∏è Update User Settings</h3>
                            <div class="user-update-form compact">
                                <div class="form-row compact inline">
                                    <label class="filter-label" for="selected-user-display">User:</label>
                                    <div class="input-with-action">
                                        <input type="text" id="selected-user-display" readonly placeholder="Select a user from search" />
                                        <input type="hidden" id="selected-user-id" />
                                        <button id="user-clear-selection" class="icon-btn btn-sm" disabled title="Clear">‚úï</button>
                                    </div>
                                </div>
                                <div class="form-row compact">
                                    <label class="filter-label" for="user-profile-select">Profile:</label>
                                    <select id="user-profile-select" disabled aria-label="Select profile">
                                        <option value="">-- Select Profile --</option>
                                    </select>
                                </div>
                                <div class="form-row compact">
                                    <label class="filter-label" for="user-role-select">Role:</label>
                                    <select id="user-role-select" disabled aria-label="Select role">
                                        <option value="">-- No Role --</option>
                                    </select>
                                </div>
                                <div class="form-row compact">
                                    <label class="filter-label" for="user-language-select">Language:</label>
                                    <select id="user-language-select" disabled aria-label="Select language">
                                        <option value="">-- Select Language --</option>
                                    </select>
                                </div>
                                <div class="user-update-actions compact">
                                    <button id="user-update-btn" class="btn btn-primary" disabled>üíæ Update User</button>
                                </div>
                                <div id="user-update-status" class="update-status" hidden></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sub-tab: Current Record -->
            <div id="subtab-current-record" class="sub-tab-content" hidden aria-labelledby="current-record">
                <div class="section-card">
                    <h3 class="section-card-title">üìÑ Current Page Record</h3>
                    <div class="record-actions-row">
                        <button id="refresh-record-btn" class="icon-btn btn-sm" aria-label="Refresh record info" title="Refresh">‚ü≤</button>
                    </div>
                    <div id="current-record-info" class="details-list">
                        <div class="placeholder-note">Navigate to a record page and click refresh to detect the record.</div>
                    </div>
                </div>
            </div>

            <!-- Sub-tab: Record Search -->
            <div id="subtab-record-search" class="sub-tab-content" hidden aria-labelledby="record-search">
                <div class="section-card">
                    <h3 class="section-card-title">üîé Search by Record ID</h3>
                    <p class="section-description">Enter any Salesforce Record ID (15 or 18 characters) to identify its object type and basic details.</p>
                    <div class="record-search-row">
                        <input type="text" id="record-search-input" placeholder="Enter Record ID (e.g., 001xx000003DGbYAAW)" aria-label="Record ID" />
                        <button id="record-search-btn" class="btn btn-primary btn-sm">Identify</button>
                    </div>
                    <div id="search-results-container" class="details-list">
                        <div class="placeholder-note">Enter a Record ID to identify it</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="tab-settings" class="tab-pane" data-tab="settings" hidden>
            <div class="logs-container">
                <div class="placeholder">
                    <p>Settings</p>
                    <p class="placeholder-note">Configure preferences for the extension.</p>
                </div>
            </div>
        </div>
        <div id="tab-help" class="tab-pane" data-tab="help" hidden>
            <div class="help-container">
                <div class="section-card">
                    <h3 class="section-card-title">üìö Documentation</h3>
                    <p class="section-description">Access comprehensive guides and reference materials on GitHub.</p>
                    <div class="help-links">
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor/blob/main/DOCUMENTATION/guides/USER_GUIDE.md" target="_blank" rel="noopener noreferrer" class="help-link-card">
                            <span class="help-link-icon">üìò</span>
                            <div class="help-link-content">
                                <span class="help-link-title">User Guide</span>
                                <span class="help-link-desc">Complete manual for end-users</span>
                            </div>
                            <span class="help-link-arrow">‚Üí</span>
                        </a>
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor/blob/main/DOCUMENTATION/guides/DEVELOPER_GUIDE.md" target="_blank" rel="noopener noreferrer" class="help-link-card">
                            <span class="help-link-icon">üõ†Ô∏è</span>
                            <div class="help-link-content">
                                <span class="help-link-title">Developer Guide</span>
                                <span class="help-link-desc">Setup, architecture, and contribution guidelines</span>
                            </div>
                            <span class="help-link-arrow">‚Üí</span>
                        </a>
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor/blob/main/DOCUMENTATION/reference/QUICK_REFERENCE.md" target="_blank" rel="noopener noreferrer" class="help-link-card">
                            <span class="help-link-icon">‚ö°</span>
                            <div class="help-link-content">
                                <span class="help-link-title">Quick Reference</span>
                                <span class="help-link-desc">Keyboard shortcuts, status messages, and tips</span>
                            </div>
                            <span class="help-link-arrow">‚Üí</span>
                        </a>
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor/tree/main/DOCUMENTATION/architecture" target="_blank" rel="noopener noreferrer" class="help-link-card">
                            <span class="help-link-icon">üèóÔ∏è</span>
                            <div class="help-link-content">
                                <span class="help-link-title">Architecture Docs</span>
                                <span class="help-link-desc">Technical implementation details</span>
                            </div>
                            <span class="help-link-arrow">‚Üí</span>
                        </a>
                    </div>
                </div>

                <div class="section-card">
                    <h3 class="section-card-title">üí° Quick Tips</h3>
                    <div class="tips-list">
                        <div class="tip-item">
                            <span class="tip-icon">üîÑ</span>
                            <span class="tip-text"><strong>Drag tabs</strong> to reorder them based on your workflow preferences.</span>
                        </div>
                        <div class="tip-item">
                            <span class="tip-icon">üìå</span>
                            <span class="tip-text"><strong>Pop out</strong> the extension using the window icon for a standalone experience.</span>
                        </div>
                        <div class="tip-item">
                            <span class="tip-icon">üé®</span>
                            <span class="tip-text">Use <strong>Favicon Customization</strong> to visually distinguish between orgs/sandboxes.</span>
                        </div>
                        <div class="tip-item">
                            <span class="tip-icon">‚ö°</span>
                            <span class="tip-text">Enable <strong>Guided Builder</strong> in SOQL/GraphQL tabs for assisted query creation.</span>
                        </div>
                        <div class="tip-item">
                            <span class="tip-icon">üîç</span>
                            <span class="tip-text">Paste any <strong>Salesforce ID</strong> in Record Search to identify its object type.</span>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <h3 class="section-card-title">üêõ Troubleshooting</h3>
                    <details class="troubleshoot-item">
                        <summary>"Not connected" status</summary>
                        <p>Ensure you are on a Salesforce page and logged in. The extension requires an active Salesforce session to function.</p>
                    </details>
                    <details class="troubleshoot-item">
                        <summary>Queries returning errors</summary>
                        <p>Check your SOQL/GraphQL syntax. Ensure you have API access to the objects and fields you're querying. Some objects require specific permissions.</p>
                    </details>
                    <details class="troubleshoot-item">
                        <summary>Extension not loading</summary>
                        <p>Try refreshing the Salesforce page. If the issue persists, reload the extension from chrome://extensions.</p>
                    </details>
                    <details class="troubleshoot-item">
                        <summary>Missing objects or fields</summary>
                        <p>Click the refresh button to reload the schema. Some custom objects may require specific permissions or API access.</p>
                    </details>
                </div>
            </div>
        </div>
        <div id="tab-about" class="tab-pane" data-tab="about" hidden>
            <div class="about-container">
                <div class="about-header">
                    <div class="about-logo">
                        <img src="icons/icon128.png" alt="TrackForcePro Logo" />
                    </div>
                    <div class="about-title-section">
                        <h2 class="about-title">TrackForcePro</h2>
                        <span class="about-version">Version 1.0.0</span>
                        <p class="about-tagline">Your Salesforce Development & Admin Companion</p>
                    </div>
                </div>

                <div class="section-card">
                    <h3 class="section-card-title">üöÄ About This Extension</h3>
                    <p class="about-description">
                        TrackForcePro is a powerful Chrome extension designed for Salesforce Administrators and Developers.
                        It streamlines the process of auditing fields, building GraphQL/SOQL queries, managing users,
                        and inspecting object schemas directly from your browser.
                    </p>
                </div>

                <div class="section-card">
                    <h3 class="section-card-title">üîó Links</h3>
                    <div class="about-links">
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor" target="_blank" rel="noopener noreferrer" class="about-link-card">
                            <span class="about-link-icon">üì¶</span>
                            <div class="about-link-content">
                                <span class="about-link-title">GitHub Repository</span>
                                <span class="about-link-url">github.com/manaskumarbehera/sf-audit-extractor</span>
                            </div>
                            <span class="about-link-arrow">‚Üí</span>
                        </a>
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor/tree/main/DOCUMENTATION" target="_blank" rel="noopener noreferrer" class="about-link-card">
                            <span class="about-link-icon">üìö</span>
                            <div class="about-link-content">
                                <span class="about-link-title">Documentation</span>
                                <span class="about-link-url">View guides, architecture docs & more</span>
                            </div>
                            <span class="about-link-arrow">‚Üí</span>
                        </a>
                        <a href="https://github.com/manaskumarbehera/sf-audit-extractor/issues" target="_blank" rel="noopener noreferrer" class="about-link-card">
                            <span class="about-link-icon">üêõ</span>
                            <div class="about-link-content">
                                <span class="about-link-title">Report Issues</span>
                                <span class="about-link-url">Found a bug? Let us know!</span>
                            </div>
                            <span class="about-link-arrow">‚Üí</span>
                        </a>
                    </div>
                </div>

                <div class="section-card">
                    <h3 class="section-card-title">üë®‚Äçüíª Developer</h3>
                    <div class="about-developer">
                        <div class="developer-info">
                            <span class="developer-name">Manas Behera</span>
                            <span class="developer-role">Salesforce Developer & Architect</span>
                        </div>
                        <a href="https://www.linkedin.com/in/manas-behera-68607547/" target="_blank" rel="noopener noreferrer" class="linkedin-link">
                            <svg class="linkedin-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                            <span>Connect on LinkedIn</span>
                        </a>
                    </div>
                </div>

                <div class="section-card">
                    <h3 class="section-card-title">üìú License & Credits</h3>
                    <p class="about-license">
                        This project is open source. Contributions, issues, and feature requests are welcome!
                    </p>
                    <p class="about-copyright">
                        ¬© 2024-2026 Manas Behera. All rights reserved.
                    </p>
                </div>
            </div>
        </div>

    </section>

    <!-- Platform Event Publish Modal -->
    <div id="pe-publish-modal" class="modal-overlay" hidden>
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Publish Platform Event</h3>
                <button id="pe-modal-close" class="icon-btn modal-close" aria-label="Close modal" title="Close"></button>
            </div>
            <div class="modal-body">
                <div class="modal-event-info">
                    <label class="filter-label">Event:</label>
                    <span id="pe-modal-event-name" class="event-name-badge"></span>
                </div>
                <div class="modal-field-group">
                    <label class="filter-label" for="pe-payload-textarea">Payload (JSON):</label>
                    <div class="payload-editor-wrap">
                        <textarea id="pe-payload-textarea" rows="10" placeholder='{ "Field__c": "value" }' aria-label="Platform Event payload JSON"></textarea>
                        <button id="pe-payload-format" class="icon-btn format-btn" aria-label="Format JSON" title="Format JSON">{ }</button>
                    </div>
                    <div id="pe-payload-error" class="field-error" hidden></div>
                </div>
                <div class="modal-hint">
                    <details>
                        <summary>Available Fields</summary>
                        <div id="pe-modal-fields-list" class="fields-list">
                            <span class="placeholder-note">Loading fields...</span>
                        </div>
                    </details>
                </div>
            </div>
            <div class="modal-footer">
                <button id="pe-modal-cancel" class="btn btn-secondary">Cancel</button>
                <button id="pe-modal-publish" class="btn btn-primary">
                    <span class="btn-text">Publish Event</span>
                    <span class="btn-loading" hidden>‚è≥</span>
                </button>
            </div>
        </div>
    </div>

    <footer class="app-footer" role="contentinfo">
        <div class="footer-inner">
            <span>Developed by </span>
            <a href="https://www.linkedin.com/in/manas-behera-68607547/" target="_blank" rel="noopener noreferrer">Manas Behera</a>
        </div>
    </footer>
</div>

<!-- Load core scripts for popup functionality -->
<script src="utils.js"></script>
<script src="platform_helper.js"></script>
<script src="lms_helper.js"></script>
<script src="audit_helper.js"></script>
<script src="soql_helper.js"></script>
<script src="scripts/soql/soql_guidance_engine.js"></script>
<script src="scripts/soql/soql_guidance.js"></script>
<script src="graphql_helper.js"></script>
<script src="data_explorer_helper.js"></script>
<script src="settings_helper.js"></script>
<script type="module" src="popup.js"></script>
</body>
</html>



