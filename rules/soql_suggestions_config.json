{
  "meta": { "name": "soql-editor-suggestions-policy", "version": "1.3.1", "updatedAt": "2025-10-24" },
  "declarativeOnly": true,
  "lifecycle": {
    "states": ["IDLE","SELECTING_FIELDS","CHOOSING_OBJECT","FILTERING","GROUPING","HAVING_AGG","ORDERING","LIMITING","OFFSETTING","SUBQUERY","ERROR_RECOVERY"],
    "order": ["SELECTING_FIELDS","CHOOSING_OBJECT","FILTERING","GROUPING","HAVING_AGG","ORDERING","LIMITING","OFFSETTING"]
  },
  "clauseOrder": {
    "topLevel": ["SELECT","FROM","WHERE","GROUP BY","HAVING","ORDER BY","LIMIT","OFFSET","FOR UPDATE"],
    "subquery": ["SELECT","FROM(childRelationship)","WHERE","LIMIT"]
  },
  "sessionContextDefaults": {
    "isActive": true,
    "phase": "IDLE",
    "cursorContext": "top-level",
    "object": null,
    "fieldListMode": "none",
    "hasLimit": false,
    "hasOffset": false,
    "errors": [],
    "emittedSuggestions": [],
    "lastEmittedAt": {}
  },
  "conflictResolution": {
    "groupStrategy": "highest-priority-wins",
    "deDupeBy": ["message","id"],
    "applyFireOncePer": true,
    "respectCooldown": true
  },
  "suggestions": [
    {
      "id": "starter_suggestions",
      "type": "starter",
      "enabled": true,
      "priority": 100,
      "phaseAllow": ["IDLE","SELECTING_FIELDS"],
      "mutexGroup": "starter",
      "guard": "Offer only SELECT when the editor is empty",
      "fireOncePer": "query",
      "cooldownMs": 0,
      "visibility": "inline-hint",
      "severity": "info",
      "matchOn": "query",
      "matchRegex": "^\\s*$",
      "apply": { "type": "replace", "text": "SELECT ", "label": "Start a SELECT" },
      "message": "Begin a SOQL SELECT"
    },

    {
      "id": "fields-macro-helpers",
      "type": "fields_helpers",
      "enabled": true,
      "priority": 99,
      "phaseAllow": ["SELECTING_FIELDS"],
      "mutexGroup": "field-list-shape",
      "guard": "Show FIELDS(...) only right after typing SELECT (not on empty editor).",
      "fireOncePer": "phase",
      "cooldownMs": 0,
      "visibility": "inline-hint",
      "severity": "info",
      "matchOn": "query",
      "matchRegex": "^\\s*SELECT\\s*$",
      "notMatchRegex": "\\bFIELDS\\s*\\(",
      "choices": ["FIELDS(ALL) ", "FIELDS(STANDARD) ", "FIELDS(CUSTOM) "],
      "message": "Insert a FIELDS(...) macro"
    },
    {
      "id": "suppress-fields-when-macro-present",
      "type": "suppress_keyword",
      "enabled": true,
      "priority": 101,
      "phaseAllow": ["SELECTING_FIELDS"],
      "mutexGroup": "field-list-shape",
      "guard": "Hide FIELDS(...) helpers once a FIELDS macro exists",
      "fireOncePer": "phase",
      "cooldownMs": 0,
      "visibility": "hidden",
      "severity": "block",
      "matchOn": "query",
      "matchRegex": "\\bFIELDS\\s*\\(",
      "message": "FIELDS macro already present."
    },

    {
      "id": "suggest-from-after-select",
      "type": "next_keyword",
      "enabled": true,
      "priority": 95,
      "phaseAllow": ["SELECTING_FIELDS"],
      "mutexGroup": "next-keyword",
      "guard": "Add FROM after FIELDS(...)",
      "fireOncePer": "query",
      "cooldownMs": 0,
      "visibility": "inline-hint",
      "severity": "tip",
      "matchOn": "query",
      "matchRegex": "\\bSELECT\\b[\\s\\S]*\\bFIELDS\\s*\\(\\s*(ALL|STANDARD|CUSTOM)\\s*\\)\\s*$",
      "notMatchRegex": "\\bFROM\\b",
      "message": "Add `FROM` to choose the base object."
    },

    {
      "id": "suggest-where-after-from",
      "type": "next_keyword",
      "enabled": true,
      "priority": 60,
      "phaseAllow": ["CHOOSING_OBJECT"],
      "mutexGroup": "next-keyword",
      "guard": "Valid base object chosen; no WHERE/GROUP/ORDER/LIMIT/OFFSET yet.",
      "fireOncePer": "phase",
      "cooldownMs": 0,
      "visibility": "inline-hint",
      "severity": "tip",
      "matchOn": "query",
      "matchRegex": "\\bFROM\\b",
      "notMatchRegex": "\\bWHERE\\b|\\bGROUP\\s+BY\\b|\\bORDER\\s+BY\\b|\\bLIMIT\\b|\\bOFFSET\\b",
      "message": "Add `WHERE` to filter results, or `ORDER BY` / `LIMIT`."
    },

    {
      "id": "limit-suggestion",
      "type": "add_limit",
      "enabled": true,
      "priority": 92,
      "phaseAllow": ["SELECTING_FIELDS","IDLE","CHOOSING_OBJECT","FILTERING","ORDERING"],
      "mutexGroup": "limit",
      "guard": "Top-level query has no LIMIT; not inside SUBQUERY; no blocking syntax errors.",
      "fireOncePer": "query",
      "cooldownMs": 60000,
      "visibility": "inline-hint",
      "severity": "tip",
      "defaultLimit": 200,
      "matchOn": "query",
      "matchRegex": "(\\bFIELDS\\b\\s*\\(\\s*(ALL|STANDARD|CUSTOM)\\s*\\)|\\bFROM\\b)",
      "notMatchRegex": "(\\bLIMIT\\b\\s*\\d+|\\(\\s*select\\b)",
      "message": "Add a LIMIT to avoid large result sets",
      "example": "LIMIT 200"
    }
  ]
}
